##############################
Configurem per connexió remota
##############################

Per a accedir des d'una màquina fora de la que conté el servidor, per
exemple del nostre amfitrió [#nossh]_, ens caldrà fer algunes
modificacions a la configuració per defecte de *PostGreSQL* de manera que
accepti connexions d'altres adreces IP a banda de la local.

El canvi requereix la modificació de dos fitxers de configuració que es
trobaran a ``/etc/postgresql/«X.Y»`` on «X.Y» correspon a la versió que
hagis instal·lat de *PostGreSQL*.

El primer fitxer a modificar és ``/etc/postgresql/11/main/pg_hba.conf``.

Obre'l com a *root* amb un editor. Per defecte disposaràs de ``vi`` o
``nano``.

.. code-block:: bash

    vagrant@stretch:~$ sudo vi /etc/postgresql/11/main/pg_hba.conf

Ara localitza-hi les següents línies:

.. code-block:: none

    # IPv4 local connections:
    host    all             all             127.0.0.1/32            md5

Tot just a sota, hi afegirem la següent línia:

.. code-block:: none

    host    all             all             192.168.33.0/24         md5

Guarda els canvis i surt de l'editor.

A continuació, modificarem el fitxer ``/etc/postgresql/11/main/postgresql.conf``. 

Localitza-hi la secció *Connection Settings* i ves a la línia que conté:

.. code-block:: none

    # listen_addresses = 'localhost'          # what IP address(es) to listen on;

Modifica aquesta línia de manera que resulti:

.. code-block:: none

    listen_addresses = '*'          # what IP address(es) to listen on;

Reinicia el servidor de *PostGreSQL* perquè agafi aquests canvis:

.. code-block:: none

    vagrant@stretch:~$ sudo service postgresql restart


.. rubric:: Anotacions

.. [#nossh] No et confonguis amb el fet d'estar-te connectant des d'una sessió
            *ssh*. Tot i que la connexió *ssh* l'estàs realitzant des de la màquina
            anfitriona, la connexió al servidor de *PostGreSQL* l'estàs realitzant des de
            la màquina virtual. Comprova el *prompt* per assegurar-te.

