

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ca" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ca" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>La classe Animal &mdash; Introducció a la programació 2019-20 documentació</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script src="_static/translations.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/moistyle.css" type="text/css" />
    <link rel="author" title="Quant a aquests documents" href="about.html" />
    <link rel="index" title="Índex" href="genindex.html" />
    <link rel="search" title="Cerca" href="search.html" />
    <link rel="next" title="Resta d’operacions CRUD" href="bdcovid_altresoperacions.html" />
    <link rel="prev" title="La classe Categoria" href="bdcovid_classe_categoria.html" />
     
    <script class="googleanalytics" src="_static/moiscripts.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Introducció a la programació
          

          
            
            <img src="_static/logoprg.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1920
              </div>
            
          

          

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="primeres_passes.html">Primeres passes</a></li>
<li class="toctree-l1"><a class="reference internal" href="instruccions.html">Instruccions</a></li>
<li class="toctree-l1"><a class="reference internal" href="condicionals.html">Condicionals</a></li>
<li class="toctree-l1"><a class="reference internal" href="iteracions.html">Iteracions</a></li>
<li class="toctree-l1"><a class="reference internal" href="programacio_modular.html">Programació Modular</a></li>
<li class="toctree-l1"><a class="reference internal" href="python2java.html">De Python a Java</a></li>
<li class="toctree-l1"><a class="reference internal" href="fitxers.html">Fitxers</a></li>
<li class="toctree-l1"><a class="reference internal" href="estructures.html">Estructures</a></li>
<li class="toctree-l1"><a class="reference internal" href="poo.html">Programació Orientada a Objectes</a></li>
<li class="toctree-l1"><a class="reference internal" href="web.html">Aplicacions Web</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="bdcovid.html">Persistència amb bases de dades (2019-20)</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="bdcovid_sqlite.html">SQLite</a></li>
<li class="toctree-l2"><a class="reference internal" href="bdcovid_model_de_dades.html">El model de dades</a></li>
<li class="toctree-l2"><a class="reference internal" href="bdcovid_connecta_i_desconnecta.html">Connexió i desconnexió</a></li>
<li class="toctree-l2"><a class="reference internal" href="bdcovid_classe_categoria.html">La classe <em>Categoria</em></a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">La classe <em>Animal</em></a></li>
<li class="toctree-l2"><a class="reference internal" href="bdcovid_altresoperacions.html">Resta d’operacions <em>CRUD</em></a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Introducció a la programació</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="bdcovid.html">Persistència amb bases de dades (2019-20)</a> &raquo;</li>
        
      <li>La classe <em>Animal</em></li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
    
           <div itemprop="articleBody">
            
  <div class="section" id="la-classe-animal">
<h1>La classe <em>Animal</em><a class="headerlink" href="#la-classe-animal" title="Link permanent a aquest títol">¶</a></h1>
<div class="section" id="id1">
<h2>La classe <em>Animal</em><a class="headerlink" href="#id1" title="Link permanent a aquest títol">¶</a></h2>
<p>Implementarem La classe <em>Animal</em> de la següent manera:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text"><a class="reference download internal" download="" href="_downloads/15c7089bc188b48f51cd5f86b458a6c0/Animal.java"><code class="xref download docutils literal notranslate"><span class="pre">src/main/java/Animal.java</span></code></a></span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Animal</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">bdId</span><span class="p">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">nom</span><span class="p">;</span>
    <span class="kd">private</span> <span class="n">Categoria</span> <span class="n">categoria</span><span class="p">;</span>

    <span class="kd">public</span> <span class="nf">Animal</span><span class="p">(</span><span class="kt">int</span> <span class="n">bdId</span><span class="p">,</span> <span class="n">String</span> <span class="n">nom</span><span class="p">,</span> <span class="n">Categoria</span> <span class="n">categoria</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">bdId</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;L&#39;identificador ha de ser positiu&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="na">bdId</span> <span class="o">=</span> <span class="n">bdId</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">nom</span> <span class="o">=</span> <span class="n">nom</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">categoria</span> <span class="o">=</span> <span class="n">categoria</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="nf">Animal</span><span class="p">(</span><span class="n">String</span> <span class="n">nom</span><span class="p">,</span> <span class="n">Categoria</span> <span class="n">categoria</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="na">bdId</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">nom</span> <span class="o">=</span> <span class="n">nom</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="na">categoria</span> <span class="o">=</span> <span class="n">categoria</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">idIndefinit</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">bdId</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getId</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">bdId</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getNom</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">nom</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">Categoria</span> <span class="nf">getCategoria</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">categoria</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="s">&quot;Animal(id:&quot;</span> <span class="o">+</span>
            <span class="p">(</span><span class="n">bdId</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="o">?</span> <span class="s">&quot;indefinit&quot;</span> <span class="p">:</span> <span class="n">bdId</span><span class="p">)</span> <span class="o">+</span>
            <span class="s">&quot;, &quot;</span> <span class="o">+</span> 
            <span class="n">nom</span> <span class="o">+</span>
            <span class="s">&quot;, &quot;</span> <span class="o">+</span> 
            <span class="n">categoria</span> <span class="o">+</span>
            <span class="s">&quot;)&quot;</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<p>Com podem veure, res especial. Molt similar a l’estructura de <em>Categoria</em>
però amb un camp addicional (la categoria).</p>
</div>
<div class="section" id="la-taula-animals">
<h2>La taula <em>ANIMALS</em><a class="headerlink" href="#la-taula-animals" title="Link permanent a aquest títol">¶</a></h2>
<p>Emmagatzemarem els valors que composen les instàncies d”<em>Animal</em> a la
taula <em>ANIMALS</em> que podem definir de la següent manera:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">ANIMALS</span> <span class="p">(</span>
    <span class="n">id</span>        <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="n">AUTOINCREMENT</span><span class="p">,</span>
    <span class="n">nom</span>       <span class="nb">TEXT</span><span class="p">,</span>
    <span class="n">categoria</span> <span class="nb">INTEGER</span><span class="p">,</span>
    <span class="k">FOREIGN</span> <span class="k">KEY</span><span class="p">(</span><span class="n">categoria</span><span class="p">)</span> <span class="k">REFERENCES</span> <span class="n">CATEGORIES</span><span class="p">(</span><span class="n">id</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="exercici-4-creacio-i-destruccio-de-la-taula-animals">
<h2>Exercici 4. Creació i destrucció de la taula <em>ANIMALS</em><a class="headerlink" href="#exercici-4-creacio-i-destruccio-de-la-taula-animals" title="Link permanent a aquest títol">¶</a></h2>
<p>Desenvolupa els mètodes de <em>Zoo</em>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">creaTaulaAnimals()</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">eliminaTaulaAnimals()</span></code></p></li>
</ul>
<p>Aquests mètodes són pràcticament idèntics als de la taula <em>CATEGORIES</em>.
Si se t’acut com, pots mirar de reduir el codi duplicat.</p>
<p>Atenció! Hi ha una situació especial. Quan eliminem la taula <em>CATEGORIES</em>,
primer hauríem d’eliminar la taula <em>ANIMALS</em>, doncs aquesta depen
d’aquella. Això ho pots solucionar fàcilment tot cridant
<code class="docutils literal notranslate"><span class="pre">eliminaTaulaAnimals()</span></code> a <code class="docutils literal notranslate"><span class="pre">eliminaTaulaCategories()</span></code>.</p>
</div>
<div class="section" id="inserir-un-animal">
<h2>Inserir un animal<a class="headerlink" href="#inserir-un-animal" title="Link permanent a aquest títol">¶</a></h2>
<p>Inserir un animal a la base de dades no serà tan fàcil com inserir una
categoria. El problema és que per a poder inserir l’animal, ens caldrà
disposar de l’identificador de la categoria.</p>
<p>Considera el codi parcial de <em>Zoo</em>:</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Zoo</span> <span class="p">{</span>

    <span class="c1">// …</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">afegeixAnimal</span><span class="p">(</span><span class="n">Animal</span> <span class="n">animal</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
        <span class="kt">int</span> <span class="n">idCategoria</span> <span class="o">=</span> <span class="n">obteIdCategoriaAnimal</span><span class="p">(</span><span class="n">animal</span><span class="p">);</span>
        <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;INSERT INTO ANIMALS (nom, categoria) VALUES (&#39;&quot;</span> <span class="o">+</span>
            <span class="n">animal</span><span class="p">.</span><span class="na">getNom</span><span class="p">()</span> <span class="o">+</span>
            <span class="s">&quot;&#39;, &quot;</span> <span class="o">+</span>
            <span class="n">idCategoria</span> <span class="o">+</span>
            <span class="s">&quot;)&quot;</span><span class="p">;</span>
        <span class="k">try</span> <span class="p">(</span><span class="n">Statement</span> <span class="n">st</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">())</span> <span class="p">{</span>
            <span class="kt">int</span> <span class="n">num</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="na">executeUpdate</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
            <span class="k">return</span> <span class="s">&quot;Nombre d&#39;animals afegits: &quot;</span> <span class="o">+</span> <span class="n">num</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kt">int</span> <span class="nf">obteIdCategoriaAnimal</span><span class="p">(</span><span class="n">Animal</span> <span class="n">animal</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
        <span class="n">Categoria</span> <span class="n">categoria</span> <span class="o">=</span> <span class="n">animal</span><span class="p">.</span><span class="na">getCategoria</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">categoria</span><span class="p">.</span><span class="na">idIndefinit</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">recuperaCategoriaPerNom</span><span class="p">(</span><span class="n">categoria</span><span class="p">.</span><span class="na">getNom</span><span class="p">()).</span><span class="na">getId</span><span class="p">();</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">categoria</span><span class="p">.</span><span class="na">getId</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Categoria</span><span class="o">&gt;</span> <span class="nf">recuperaCategories</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;SELECT * FROM CATEGORIES ORDER BY nom&quot;</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">recuperaCategoriesAmbSQL</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">Categoria</span> <span class="nf">recuperaCategoriaPerNom</span><span class="p">(</span><span class="n">String</span> <span class="n">nom</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;SELECT * FROM CATEGORIES WHERE nom = &#39;&quot;</span> <span class="o">+</span> <span class="n">nom</span> <span class="o">+</span> <span class="s">&quot;&#39;&quot;</span><span class="p">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Categoria</span><span class="o">&gt;</span> <span class="n">categories</span> <span class="o">=</span> <span class="n">recuperaCategoriesAmbSQL</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">categories</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;El nombre de categories amb el nom &quot;</span> <span class="o">+</span>
                    <span class="n">nom</span> <span class="o">+</span> <span class="s">&quot; és &quot;</span> <span class="o">+</span> <span class="n">categories</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; i hauria de ser 1&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">categories</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Categoria</span><span class="o">&gt;</span> <span class="nf">recuperaCategoriesAmbSQL</span><span class="p">(</span><span class="n">String</span> <span class="n">sql</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">(</span><span class="n">Statement</span> <span class="n">st</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Categoria</span><span class="o">&gt;</span> <span class="n">categories</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">bdId</span> <span class="o">=</span> <span class="n">rs</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">);</span>
                <span class="n">String</span> <span class="n">nom</span> <span class="o">=</span> <span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;nom&quot;</span><span class="p">);</span>
                <span class="n">Categoria</span> <span class="n">categoria</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Categoria</span><span class="p">(</span><span class="n">bdId</span><span class="p">,</span> <span class="n">nom</span><span class="p">);</span>
                <span class="n">categories</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">categoria</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">rs</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
            <span class="k">return</span> <span class="n">categories</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Comentaris:</p>
<ul>
<li><p>En primer lloc, definim el mètode <code class="docutils literal notranslate"><span class="pre">afegeixAnimal()</span></code> que rep una
instància d”<em>Animal</em></p>
<p>Aquest mètode es limita a cridar el mètode privat
<code class="docutils literal notranslate"><span class="pre">obteIdCategoriaAnimal()</span></code> per obtenir l’identificador de la categoria
d’animal, composa la <em>query</em> i la llença, tal i com ho feia
<code class="docutils literal notranslate"><span class="pre">afegeixCategoria()</span></code>.</p>
</li>
<li><p>el mètode <code class="docutils literal notranslate"><span class="pre">obteIdCategoriaAnimal()</span></code> preveu dues situacions:</p>
<ul class="simple">
<li><p>si la categoria de l’animal que rep ja està definida, retorna el seu
identificador</p></li>
<li><p>si la categoria no té definit l’identificador, el cerca a la base de
dades fent servir la funció <code class="docutils literal notranslate"><span class="pre">recuperaCategoriaPerNom()</span></code></p></li>
</ul>
</li>
<li><p>donat que <code class="docutils literal notranslate"><span class="pre">recuperaCategoriaPerNom()</span></code> és bàsicament el mateix que
<code class="docutils literal notranslate"><span class="pre">recrecuperaCategories()</span></code>, excepte que només espera un valor,
he fet un petit pas de <em>refacció</em> (o <em>refactoring</em>) de manera que la
funcionalitat de recollir el resultat d’una consulta a la taula de
<em>CATEGORIES</em> sigui realitzada pel mètode privat
<code class="docutils literal notranslate"><span class="pre">recuperaCategoriesAmbSQL()</span></code> i tant <code class="docutils literal notranslate"><span class="pre">recuperaCategoriaPerNom()</span></code> com
la ja existent <code class="docutils literal notranslate"><span class="pre">recuperaCategories()</span></code> es limiten a passar al nou
mètode el SQL corresponent.</p>
<p>És molt habitual «treure factor comú» del nostre codi per evitar
redundàncies com aquesta per millorar la mantenibilitat dels nostres
programes. Únicament un consell: <em>no t’obsessionis refactoritzant</em> doncs
no sempre té sentit</p>
</li>
</ul>
<p>Provem a fer servir la nova funcionalitat d’afegir animals, tot ampliant
el nostre <em>Main</em> amb les següents línies tot just després de la creació de
la taula d”<em>ANIMALS</em>.</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">Animal</span> <span class="n">canari</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Animal</span><span class="p">(</span><span class="s">&quot;Canari&quot;</span><span class="p">,</span> <span class="n">ocell</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot;Inserim &quot;</span> <span class="o">+</span> <span class="n">canari</span> <span class="o">+</span> <span class="s">&quot;; &quot;</span><span class="p">);</span>
<span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">zoo</span><span class="p">.</span><span class="na">afegeixAnimal</span><span class="p">(</span><span class="n">canari</span><span class="p">));</span>
</pre></div>
</div>
<p>Recorda que ja disposes de la variable <code class="docutils literal notranslate"><span class="pre">canari</span></code> de tipus <em>Categoria</em>
encara que no conté el identificador.</p>
<p>Si ara executem la nostra aplicació, ens trobem la següent sortida:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Primer connectem amb la base de dades: Connectat a animals.bd
Creem la taula CATEGORIES: Creada taula CATEGORIES
Inserim Categoria(id:indefinit, ocell): Nombre de categories afegides: 1
Inserim Categoria(id:indefinit, mamífer): Nombre de categories afegides: 1
Recupera les categories: Nombre de categories trobades = 2
        Categoria(id:2, mamífer)
        Categoria(id:1, ocell)
Inserim més categories: Nombre de categories afegides: 2
Recupera les categories: Nombre de categories trobades = 4
        Categoria(id:2, mamífer)
        Categoria(id:1, ocell)
        Categoria(id:3, peix)
        Categoria(id:4, rèptil)
Creem la taula ANIMALS: Creada taula ANIMALS
Inserim Animal(id:indefinit, Canari, Categoria(id:indefinit, ocell)); Nombre d&#39;animals afegits: 1
Finalment tanquem la connexió amb la base de dades: Desconnectat
</pre></div>
</div>
<p>Podem comprovar que la base de dades conté l’esperat amb:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>$ sqlite3 animals.bd &quot;select * from animals&quot;
1|Canari|1
</pre></div>
</div>
<p>El primer <code class="docutils literal notranslate"><span class="pre">1</span></code> correspon a l’identificador de l’animal, mentre que el
segon, és el corresponent a la seva categoria («ocell»)</p>
</div>
<div class="section" id="exercici-5-fes-funcionar-el-codi-fins-aqui">
<h2>Exercici 5. Fes funcionar el codi fins aquí<a class="headerlink" href="#exercici-5-fes-funcionar-el-codi-fins-aqui" title="Link permanent a aquest títol">¶</a></h2>
<p>Acaba de composar tot el codi que tenim fins ara, de manera que en
executar <em>Main</em> obtinguis aquesta sortida indicada.</p>
</div>
<div class="section" id="recupera-animals">
<h2>Recupera animals<a class="headerlink" href="#recupera-animals" title="Link permanent a aquest títol">¶</a></h2>
<p>La recuperació dels animals que hi ha a la base de dades, per poder-los
mostrar, és molt similar a la corresponent a les categories. En aquest
cas, però, ens caldrà tenir en comptes que els animals a la base de dades,
tenen l’identificador de la categoria i no la categoria en sí. Això ens
requerirà una mica més de feina a l’hora de composar els animals.</p>
<p>El codi de <code class="docutils literal notranslate"><span class="pre">Zoo.recuperaAnimals()</span></code> pot tenir el següent aspecte:</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span> <span class="nf">recuperaAnimals</span><span class="p">()</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;SELECT * FROM ANIMALS ORDER BY nom&quot;</span><span class="p">;</span>
        <span class="k">try</span> <span class="p">(</span><span class="n">Statement</span> <span class="n">st</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="na">createStatement</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">st</span><span class="p">.</span><span class="na">executeQuery</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
            <span class="n">List</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span> <span class="n">animals</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="o">&lt;&gt;</span><span class="p">();</span>
            <span class="k">while</span> <span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">next</span><span class="p">())</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">bdId</span> <span class="o">=</span> <span class="n">rs</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="s">&quot;id&quot;</span><span class="p">);</span>
                <span class="n">String</span> <span class="n">nom</span> <span class="o">=</span> <span class="n">rs</span><span class="p">.</span><span class="na">getString</span><span class="p">(</span><span class="s">&quot;nom&quot;</span><span class="p">);</span>
                <span class="n">Categoria</span> <span class="n">categoria</span> <span class="o">=</span> <span class="n">recuperaCategoriaPerId</span><span class="p">(</span><span class="n">rs</span><span class="p">.</span><span class="na">getInt</span><span class="p">(</span><span class="s">&quot;categoria&quot;</span><span class="p">));</span>
                <span class="n">Animal</span> <span class="n">animal</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Animal</span><span class="p">(</span><span class="n">bdId</span><span class="p">,</span> <span class="n">nom</span><span class="p">,</span> <span class="n">categoria</span><span class="p">);</span>
                <span class="n">animals</span><span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">animal</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="n">rs</span><span class="p">.</span><span class="na">close</span><span class="p">();</span>
            <span class="k">return</span> <span class="n">animals</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="n">Categoria</span> <span class="nf">recuperaCategoriaPerId</span><span class="p">(</span><span class="kt">int</span> <span class="n">bdId</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;SELECT * FROM CATEGORIES WHERE id = &quot;</span> <span class="o">+</span> <span class="n">bdId</span><span class="p">;</span>
        <span class="n">List</span><span class="o">&lt;</span><span class="n">Categoria</span><span class="o">&gt;</span> <span class="n">categories</span> <span class="o">=</span> <span class="n">recuperaCategoriesAmbSQL</span><span class="p">(</span><span class="n">sql</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">categories</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="n">IllegalArgumentException</span><span class="p">(</span><span class="s">&quot;El nombre de categories amb id &quot;</span> <span class="o">+</span>
                    <span class="n">bdId</span> <span class="o">+</span> <span class="s">&quot; és &quot;</span> <span class="o">+</span> <span class="n">categories</span><span class="p">.</span><span class="na">size</span><span class="p">()</span> <span class="o">+</span> <span class="s">&quot; i hauria de ser 1&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">categories</span><span class="p">.</span><span class="na">get</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Alguns comentaris:</p>
<ul class="simple">
<li><p>el mètode <code class="docutils literal notranslate"><span class="pre">recuperaAnimals()</span></code> presenta un codi pràcticament idèntic al
de <code class="docutils literal notranslate"><span class="pre">recrecuperaCategories()</span></code>. Únicament ha de composar una instància
de <em>Categoria</em> per a poder composar la instància d”<em>Animal</em>. (línia 9)
Això ho delega en el mètode <code class="docutils literal notranslate"><span class="pre">recuperaCategoriaPerId()</span></code> que, gràcies a
la refacció que vam fer fa una estona, ens resulta realment fàcil.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">recuperaCategoriaPerId()</span></code> en realitat podria estalviar-se la
comprovació de que només hi hagi una entrada. En teoria el nostre SGBD
se n’encarrega d’assegurar que hi ha una i només una entrada a
<em>CATEGORIES</em> amb aquest identificador. A alguns desenvolupadors ens
agrada afegir aquestes comprovacions quan no són gaire costoses, per si
de cas. Amb un SGBD com SQLite, que no força per defecte la integritat
referencial, probablement és una bona idea.</p></li>
</ul>
</div>
<div class="section" id="exercici-6-mostrem-els-animals">
<h2>Exercici 6. Mostrem els animals<a class="headerlink" href="#exercici-6-mostrem-els-animals" title="Link permanent a aquest títol">¶</a></h2>
<p>Et toca a tu desenvolupar el mètode <code class="docutils literal notranslate"><span class="pre">Main.mostraAnimals()</span></code>. Serà molt
similar al de <code class="docutils literal notranslate"><span class="pre">Main.mostraCategories()</span></code>. No oblidis, cridar a la nova
funció tot just després d’haver afegit el canari.</p>
<p>El resultat de l’execució haurà de ser:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Primer connectem amb la base de dades: Connectat a animals.bd
Creem la taula CATEGORIES: Creada taula CATEGORIES
Inserim Categoria(id:indefinit, ocell): Nombre de categories afegides: 1
Inserim Categoria(id:indefinit, mamífer): Nombre de categories afegides: 1
Recupera les categories: Nombre de categories trobades = 2
        Categoria(id:2, mamífer)
        Categoria(id:1, ocell)
Inserim més categories: Nombre de categories afegides: 2
Recupera les categories: Nombre de categories trobades = 4
        Categoria(id:2, mamífer)
        Categoria(id:1, ocell)
        Categoria(id:3, peix)
        Categoria(id:4, rèptil)
Creem la taula ANIMALS: Creada taula ANIMALS
Inserim Animal(id:indefinit, Canari, Categoria(id:indefinit, ocell)); Nombre d&#39;animals afegits: 1
Recupera els animals: Nombre d&#39;animals trobats = 1
        Animal(id:1, Canari, Categoria(id:1, ocell))
Finalment tanquem la connexió amb la base de dades: Desconnectat
</pre></div>
</div>
</div>
<div class="section" id="exercici-7-afegim-mes-animals">
<h2>Exercici 7. Afegim més animals<a class="headerlink" href="#exercici-7-afegim-mes-animals" title="Link permanent a aquest títol">¶</a></h2>
<p>En aquest exercici et toca comprovar que has entès com va el tema de la
composició d’instàncies d’animals.</p>
<p>Completa el mètode <code class="docutils literal notranslate"><span class="pre">Zoo.afegeiAnimals()</span></code> que et mostro (molt) parcialment a continuació:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="n">String</span> <span class="nf">afegeixAnimals</span><span class="p">(</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span> <span class="n">animals</span><span class="p">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="p">{</span>
    <span class="n">String</span> <span class="n">sql</span> <span class="o">=</span> <span class="s">&quot;INSERT INTO ANIMALS (nom, categoria) values (?, ?)&quot;</span><span class="p">;</span>
    <span class="k">try</span> <span class="p">(</span><span class="n">PreparedStatement</span> <span class="n">ps</span> <span class="o">=</span> <span class="n">conn</span><span class="p">.</span><span class="na">prepareStatement</span><span class="p">(</span><span class="n">sql</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// …</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>La seva estructura és pràcticament la mateixa que <code class="docutils literal notranslate"><span class="pre">afegeixCategories()</span></code>.
Únicament has de tenir en consideració què:</p>
<ul>
<li><p>hauràs de composar la categoria a partir d’un identificador. Per això
disposes de <code class="docutils literal notranslate"><span class="pre">obteIdCategoriaAnimal()</span></code> oi?</p></li>
<li><p>el camp <em>categoria</em> dels registres de la taula <em>ANIMALS</em> es de tipus
enter, per tant, per assignar-li el valor de la categoria, ho farem amb:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span><span class="p">.</span><span class="na">setInt</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">idCategoria</span><span class="p">);</span>
</pre></div>
</div>
<p>Fixa’t que, en comptes de <code class="docutils literal notranslate"><span class="pre">setString()</span></code> ara serà <code class="docutils literal notranslate"><span class="pre">setInt()</span></code> i que el
valor <code class="docutils literal notranslate"><span class="pre">2</span></code> és refereix al segon <code class="docutils literal notranslate"><span class="pre">?</span></code> de la sentència SQL.</p>
</li>
</ul>
<p>El provaràs amb el següent codi a <em>Main</em> (tot just després d’haver mostrat
el canari.</p>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span></span>    <span class="n">Categoria</span> <span class="n">peix</span> <span class="o">=</span> <span class="n">zoo</span><span class="p">.</span><span class="na">recuperaCategoriaPerNom</span><span class="p">(</span><span class="s">&quot;peix&quot;</span><span class="p">);</span>
    <span class="n">Categoria</span> <span class="n">reptil</span> <span class="o">=</span> <span class="n">zoo</span><span class="p">.</span><span class="na">recuperaCategoriaPerNom</span><span class="p">(</span><span class="s">&quot;rèptil&quot;</span><span class="p">);</span>
    <span class="n">List</span><span class="o">&lt;</span><span class="n">Animal</span><span class="o">&gt;</span> <span class="n">nousAnimals</span> <span class="o">=</span> <span class="n">Arrays</span><span class="p">.</span><span class="na">asList</span><span class="p">(</span>
            <span class="k">new</span> <span class="n">Animal</span><span class="p">(</span><span class="s">&quot;estruç&quot;</span><span class="p">,</span> <span class="n">ocell</span><span class="p">),</span>
            <span class="k">new</span> <span class="n">Animal</span><span class="p">(</span><span class="s">&quot;kiwi&quot;</span><span class="p">,</span> <span class="n">ocell</span><span class="p">),</span>
            <span class="k">new</span> <span class="n">Animal</span><span class="p">(</span><span class="s">&quot;gos&quot;</span><span class="p">,</span> <span class="n">mamifer</span><span class="p">),</span>
            <span class="k">new</span> <span class="n">Animal</span><span class="p">(</span><span class="s">&quot;bacallà&quot;</span><span class="p">,</span> <span class="n">peix</span><span class="p">),</span>
            <span class="k">new</span> <span class="n">Animal</span><span class="p">(</span><span class="s">&quot;dofí&quot;</span><span class="p">,</span> <span class="n">peix</span><span class="p">),</span>
            <span class="k">new</span> <span class="n">Animal</span><span class="p">(</span><span class="s">&quot;gecko&quot;</span><span class="p">,</span> <span class="n">reptil</span><span class="p">)</span>
            <span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">print</span><span class="p">(</span><span class="s">&quot;Inserim més animals: &quot;</span><span class="p">);</span>
    <span class="n">System</span><span class="p">.</span><span class="na">out</span><span class="p">.</span><span class="na">println</span><span class="p">(</span><span class="n">zoo</span><span class="p">.</span><span class="na">afegeixAnimals</span><span class="p">(</span><span class="n">nousAnimals</span><span class="p">));</span>
</pre></div>
</td></tr></table></div>
<p>Fixa’t que ens toca recuperar les categories de peixos i rèptils, doncs
les havíem creades directament dins d’una llista.</p>
<p>El resultat d’executar el programa serà:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>Primer connectem amb la base de dades: Connectat a animals.bd
Creem la taula CATEGORIES: Creada taula CATEGORIES
Inserim Categoria(id:indefinit, ocell): Nombre de categories afegides: 1
Inserim Categoria(id:indefinit, mamífer): Nombre de categories afegides: 1
Recupera les categories: Nombre de categories trobades = 2
        Categoria(id:2, mamífer)
        Categoria(id:1, ocell)
Inserim més categories: Nombre de categories afegides: 2
Recupera les categories: Nombre de categories trobades = 4
        Categoria(id:2, mamífer)
        Categoria(id:1, ocell)
        Categoria(id:3, peix)
        Categoria(id:4, rèptil)
Creem la taula ANIMALS: Creada taula ANIMALS
Inserim Animal(id:indefinit, Canari, Categoria(id:indefinit, ocell)); Nombre d&#39;animals afegits: 1
Recupera els animals: Nombre d&#39;animals trobats = 1
        Animal(id:1, Canari, Categoria(id:1, ocell))
Inserim més animals: Nombre d&#39;animals afegits: 6
Recupera els animals: Nombre d&#39;animals trobats = 7
        Animal(id:1, Canari, Categoria(id:1, ocell))
        Animal(id:5, bacallà, Categoria(id:3, peix))
        Animal(id:6, dofí, Categoria(id:3, peix))
        Animal(id:2, estruç, Categoria(id:1, ocell))
        Animal(id:7, gecko, Categoria(id:4, rèptil))
        Animal(id:4, gos, Categoria(id:2, mamífer))
        Animal(id:3, kiwi, Categoria(id:1, ocell))
Finalment tanquem la connexió amb la base de dades: Desconnectat
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
    <div class="googleanalytics">
    <div id="cookiesbox">
        Aquest lloc web utilitza galetes (<i>cookies</i>) per a analitzar el seu ús
        amb les eines que ofereix <a href="https://www.google.com/analytics">Google Analytics</a>.
        En continuar navegant-hi, estàs acceptant-ho.
        <br/>
        <a class="btn btn-neutral" onclick="setUserAcceptsCookies();">
            Tancar
            <span class="fa fa-window-close"></span>
        </a>
    </div>
    <script>setCookiesboxVisibility();</script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-41103782-2', 'auto');
      ga('send', 'pageview');
    </script>
</div>


          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bdcovid_altresoperacions.html" class="btn btn-neutral float-right" title="Resta d’operacions CRUD" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="bdcovid_classe_categoria.html" class="btn btn-neutral float-left" title="La classe Categoria" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019-2020 Moisès Gómez Girón

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>