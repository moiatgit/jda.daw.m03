

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="ca" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="ca" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Primeres consultes a PostGreSQL &mdash; Introducció a la programació 1819 documentació</title>
  

  
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/moistyle.css" type="text/css" />
    <link rel="author" title="Quant a aquests documents" href="about.html" />
    <link rel="index" title="Índex" href="genindex.html" />
    <link rel="search" title="Cerca" href="search.html" />
    <link rel="next" title="JDBC amb Model relacional" href="bd.consultes.html" />
    <link rel="prev" title="Instal·lació del driver per PostGreSQL" href="bd.jdbc.install.html" />
     
    <script src="_static/moiscripts.js"></script>


  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> Introducció a la programació
          

          
            
            <img src="_static/logoprg.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                1819
              </div>
            
          

          

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="primeres_passes.html">Primeres passes</a></li>
<li class="toctree-l1"><a class="reference internal" href="dades.html">Dades</a></li>
<li class="toctree-l1"><a class="reference internal" href="operadors_i_expressions.html">Operadors i expressions</a></li>
<li class="toctree-l1"><a class="reference internal" href="instruccions.html">Instruccions seqüencials</a></li>
<li class="toctree-l1"><a class="reference internal" href="condicionals.html">Condicionals</a></li>
<li class="toctree-l1"><a class="reference internal" href="iteracions.html">Iteracions</a></li>
<li class="toctree-l1"><a class="reference internal" href="strings.html">Strings</a></li>
<li class="toctree-l1"><a class="reference internal" href="programacio_modular.html">Programació Modular</a></li>
<li class="toctree-l1"><a class="reference internal" href="bucles_condicionals.html">Bucles condicionals</a></li>
<li class="toctree-l1"><a class="reference internal" href="sequencies.html">Seqüències</a></li>
<li class="toctree-l1"><a class="reference internal" href="python2java.html">De Python a Java</a></li>
<li class="toctree-l1"><a class="reference internal" href="fitxers.html">Fitxers</a></li>
<li class="toctree-l1"><a class="reference internal" href="estructures.html">Estructures</a></li>
<li class="toctree-l1"><a class="reference internal" href="poo.html">Programació Orientada a Objectes</a></li>
<li class="toctree-l1"><a class="reference internal" href="contenidors.html">Agrupacions d’objectes</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="bd.html">Persistència amb bases de dades</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="bd.modelrelacional_i_poo.html">La programació orientada a objectes i el model relacional</a></li>
<li class="toctree-l2"><a class="reference internal" href="bd.postgresql.html">PostgreSQL</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="bd.jdbc.html">PostGreSQL JDBC</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="bd.jdbc.descripcio.html">Què és JDBC</a></li>
<li class="toctree-l3"><a class="reference internal" href="bd.jdbc.install.html">Instal·lació del driver per PostGreSQL</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Primeres consultes a PostGreSQL</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="bd.consultes.html">JDBC amb Model relacional</a></li>
<li class="toctree-l2"><a class="reference internal" href="bd.agenda.html">L’agenda</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Introducció a la programació</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
          <li><a href="bd.html">Persistència amb bases de dades</a> &raquo;</li>
        
          <li><a href="bd.jdbc.html">PostGreSQL JDBC</a> &raquo;</li>
        
      <li>Primeres consultes a PostGreSQL</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
    <div>
    <div id="cookiesbox">
        Aquest lloc web utilitza galetes (<i>cookies</i>) per a analitzar el seu ús
        amb les eines que ofereix <a href="https://www.google.com/analytics">Google Analytics</a>.
        En continuar navegant-hi, estàs acceptant-ho.
        <br/>
        <a class="btn btn-neutral" onclick="setUserAcceptsCookies();">
            Tancar
            <span class="fa fa-window-close"></span>
        </a>
    </div>

    <script>setCookiesboxVisibility();</script>

</div>
    
           <div itemprop="articleBody">
            
  <div class="section" id="primeres-consultes-a-postgresql">
<h1>Primeres consultes a PostGreSQL<a class="headerlink" href="#primeres-consultes-a-postgresql" title="Link permanent a aquest títol">¶</a></h1>
<p>En aquesta secció veurem com podem fer unes consultes <em>molt simples</em> a un
servidor de PostGreSQL.</p>
<p>Per llençar una consulta (<em>query</em>) a la base de dades, JDBC ens
ofereix les classes <code class="docutils literal notranslate"><span class="pre">Statement</span></code> i <code class="docutils literal notranslate"><span class="pre">PreparedStatement</span></code>.</p>
<p>Considera la classe <a class="reference download internal" href="_downloads/SgbdVersion.java" download=""><code class="xref download docutils literal notranslate"><span class="pre">SgbdVersion.java</span></code></a> que:</p>
<ol class="arabic">
<li><p class="first">importa la classe <code class="docutils literal notranslate"><span class="pre">java.util.Properties</span></code> per emmagatzemar les dades
<em>sensibles</em> (usuari i password).</p>
<p>Amb <code class="docutils literal notranslate"><span class="pre">Properties</span></code> podem, per exemple, disposar de les dades en algun fitxer
extern al nostre codi, probablement protegit i segur <em>fora</em> del control de
versions.</p>
</li>
<li><p class="first">considerem un mètode per a <em>amagar</em> tots els detalls de connexió: el
<code class="docutils literal notranslate"><span class="pre">connecta()</span></code>.</p>
</li>
<li><p class="first">crea el <em>Statement</em> que permetrà llençar una comanda sql i recollir el
resultat de la seva interpretació pel SGBD.</p>
</li>
<li><p class="first">crea el <em>ResultSet</em> que contindrà el resultat obtingut d’una commanda.</p>
</li>
<li><p class="first">recupera el resultat</p>
</li>
<li><p class="first">tanca els recursos</p>
</li>
</ol>
<div class="highlight-java notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="cm">/*</span>
<span class="cm"> * Obté la versió del servidor de PostgreSQL</span>
<span class="cm"> */</span>
<span class="kn">import</span> <span class="nn">java.sql.Connection</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.DriverManager</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.Statement</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.ResultSet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.sql.SQLException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Properties</span><span class="o">;</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">SgbdVersion</span> <span class="o">{</span>
    <span class="cm">/* (2) realitza la connexió i la retorna */</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="n">Connection</span> <span class="nf">connecta</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="c1">// (1) construcció del conjunt de Properties</span>
        <span class="n">Properties</span> <span class="n">prop</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Properties</span><span class="o">();</span>
        <span class="n">prop</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;user&quot;</span><span class="o">,</span>  <span class="s">&quot;usuaribd&quot;</span><span class="o">);</span>
        <span class="n">prop</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">&quot;password&quot;</span><span class="o">,</span>  <span class="s">&quot;pass&quot;</span><span class="o">);</span>
        <span class="n">String</span> <span class="n">host</span> <span class="o">=</span> <span class="s">&quot;192.168.33.10&quot;</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">bd</span>   <span class="o">=</span> <span class="s">&quot;testbd&quot;</span><span class="o">;</span>
        <span class="n">String</span> <span class="n">cadenaConnexio</span> <span class="o">=</span> <span class="s">&quot;jdbc:postgresql://&quot;</span> <span class="o">+</span> <span class="n">host</span> <span class="o">+</span> <span class="s">&quot;/&quot;</span> <span class="o">+</span> <span class="n">bd</span><span class="o">;</span>
        <span class="k">return</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="n">cadenaConnexio</span><span class="o">,</span> <span class="n">prop</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">SQLException</span> <span class="o">{</span>
        <span class="n">Connection</span> <span class="n">conn</span> <span class="o">=</span> <span class="n">connecta</span><span class="o">();</span>
        <span class="n">Statement</span> <span class="n">st</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span> <span class="c1">// (3) crea un Statement</span>
        <span class="n">String</span> <span class="n">query</span> <span class="o">=</span> <span class="s">&quot;SELECT version()&quot;</span><span class="o">;</span>     <span class="c1">// defineix la query</span>
        <span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="n">query</span><span class="o">);</span> <span class="c1">// (4) crea un ResultSet</span>
        <span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>                             <span class="c1">// (5) recupera el resultat</span>
        <span class="n">String</span> <span class="n">versio</span> <span class="o">=</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Versió: &quot;</span> <span class="o">+</span> <span class="n">versio</span><span class="o">);</span>
        <span class="n">rs</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>                            <span class="c1">// tanca ResultSet</span>
        <span class="n">st</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>                            <span class="c1">// tanca Statement</span>
        <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>                          <span class="c1">// tanca connexió</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</td></tr></table></div>
<p>El resultat d’executar aquest programa hauria de mostrar-te la versió
del servidor de PostGreSQL a la que s’està connectant.</p>
<div class="section" id="exercici-1-obtencio-de-dades-de-la-connexio">
<h2>Exercici 1. Obtenció de dades de la connexió<a class="headerlink" href="#exercici-1-obtencio-de-dades-de-la-connexio" title="Link permanent a aquest títol">¶</a></h2>
<p>Crea la classe <code class="docutils literal notranslate"><span class="pre">InfoConnexio.java</span></code> que es connecti a la base de dades <em>testbd</em>
i:</p>
<ul class="simple">
<li>obtingui l’adreça (<em>inet address</em>) i el port amb el que es comunica
el nostre client</li>
<li>obtingui l’adreça i el port del servidor.</li>
</ul>
<p>Finalment, l’aplicació mostrarà els resultats obtinguts i finalitzarà.</p>
<p><strong>Pistes</strong>:</p>
<ul class="simple">
<li>Pots trobar la llista de funcions de sistema que ofereix PostGreSQL
a la <a class="reference external" href="https://www.postgresql.org/docs/current/functions-info.html">seva documentació oficial</a></li>
<li>Potser voldràs intentar-ho fer amb una única consulta. Al codi anterior
apareix <code class="docutils literal notranslate"><span class="pre">rs.getString(1)</span></code>. Aquest <code class="docutils literal notranslate"><span class="pre">1</span></code> indica que el que es vol és la
<strong>primera</strong> columna obtinguda.</li>
</ul>
</div>
<div class="section" id="exercici-2-cadena-de-connexio-des-d-un-fitxer">
<h2>Exercici 2. ☼ Cadena de connexió des d’un fitxer<a class="headerlink" href="#exercici-2-cadena-de-connexio-des-d-un-fitxer" title="Link permanent a aquest títol">¶</a></h2>
<p>Disposar de les dades de connexió, com ara la contrasenya, a un fitxer
extern al nostre codi té els seus avantatges. Per exemple, pots deixar
el fitxer fora del control de versions i així, si estàs compartint el
codi en un lloc públic (ex. <a class="reference external" href="https://github.com/">GitHub</a>) no corres
risc de compartir <em>massa</em>.</p>
<p>Considera la api <a class="reference external" href="https://docs.oracle.com/javase/10/docs/api/java/util/Properties.html">java.util.Properties</a>
i, amb una mica de recerca, aconsegueix que les dades de la cadena de
connexió es recullin d’un fitxer de propietats.</p>
</div>
<div class="section" id="exercici-3-dades-de-connexio-protegides">
<h2>Exercici 3. ☼ Dades de connexió protegides<a class="headerlink" href="#exercici-3-dades-de-connexio-protegides" title="Link permanent a aquest títol">¶</a></h2>
<p>El fitxer de propietats que has preparat a l’exercici anterior
presenta el problema de que la contrasenya apareix <em>oberta</em>. Qualsevol
que tingui accés al fitxer per lectura, la pot veure. Potser fent
servir les utilitats de protecció que ofereix el sistema operatiu en
tindràs prou per «garantir» la seguretat, però de vegades voldràs anar
una mica més lluny.</p>
<p>Si aquest és el teu cas, considera algun sistema d’encriptació com el
que t’ofereix la llibreria com ara <a class="reference external" href="http://www.jasypt.org/">Java Simplified Encryption</a> i crea una nova versió de l’aplicació que
et permeti protegir encara més aquestes dades tan sensibles.</p>
</div>
</div>


           </div>
           
          </div>

          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bd.consultes.html" class="btn btn-neutral float-right" title="JDBC amb Model relacional" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="bd.jdbc.install.html" class="btn btn-neutral" title="Instal·lació del driver per PostGreSQL" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Copyright 2018-2019 Moisès Gómez Girón.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'1819',
            LANGUAGE:'ca',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="_static/translations.js"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

     

  <!-- Google Analytics -->
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41103782-2', 'auto');
  ga('send', 'pageview');

</script>
  <!-- End Google Analytics -->


  

</body>
</html>